"use strict";var CloudFunc={Path:"",NAME:"Cloud Commander",NOJS:"/no-js",FS:"/fs",REFRESHICON:"refresh-icon",LEFTPANEL:"left",RIGHTPANEL:"right",SHORTNAMELENGTH:16};CloudFunc.removeLastSlash=function(e){return typeof e=="string"?e.lastIndexOf("/")===e.length-1?e.substr(e,e.length-1):e:e},CloudFunc.setTitle=function(){return CloudFunc.Path===""?CloudFunc.NAME:CloudFunc.Path+" - "+CloudFunc.NAME},CloudFunc.convertPermissionsToSymbolic=function(e){if(e===undefined)return;var t=e.charAt(0);switch(t-0){case 1:t="-";break;case 2:t="c";break;case 4:t="d";break;default:t="-"}e=e.length>5?e.substr(3):e.substr(2);var n=(e[0]-0).toString(2),r=(e[1]-0).toString(2),i=(e[2]-0).toString(2),s=(n[0]-0>0?"r":"-")+(n[1]-0>0?"w":"-")+(n[2]-0>0?"x":"-")+" "+(r[0]-0>0?"r":"-")+(r[1]-0>0?"w":"-")+(r[2]-0>0?"x":"-")+" "+(i[0]-0>0?"r":"-")+(i[1]-0>0?"w":"-")+(i[2]-0>0?"x":"-");return s},CloudFunc.convertPermissionsToNumberic=function(e){if(!e||e.length!==11)return e;var t=(e[0]==="r"?4:0)+(e[1]==="w"?2:0)+(e[2]==="x"?1:0),n=(e[4]==="r"?4:0)+(e[5]==="w"?2:0)+(e[6]==="x"?1:0),r=(e[8]==="r"?4:0)+(e[9]==="w"?2:0)+(e[10]==="x"?1:0);return"00"+t+n+r},CloudFunc.getShortedSize=function(e){if(e!==e-0)return e;var t=1024,n=1048576,r=1073741824,i=1099511627776,s=0x4000000000000,o;return e<t?o=e+"b":e<n?o=(e/t).toFixed(2)+"kb":e<r?o=(e/n).toFixed(2)+"mb":e<i?o=(e/r).toFixed(2)+"gb":e<s&&(o=(e/i).toFixed(2)+"tb"),o},CloudFunc.getShortedName=function(e,t){return e.length>CloudFunc.SHORTNAMELENGTH?e.substr(e,CloudFunc.SHORTNAMELENGTH)+"..":e},CloudFunc.getUserUIDsAndNames=function(e){var t={name:"",uid:""},n=[],r=0;do{var i=e.substr(e,e.indexOf("\n")+1);if(i){e=e.replace(i,"");var s=i.substr(i,i.indexOf(":"));i=i.replace(s+":x:","");var o=i.substr(i,i.indexOf(":"));(o-0).toString()!=="NaN"&&(t.name=s,t.uid=o,n[r++]=t,console.log("uid="+o+" name="+s))}}while(e!=="");return n},CloudFunc._getDirPath=function(e){var t=[],n=0;do t[n++]=e,e=e.substr(e,e.lastIndexOf("/"));while(e!=="");var r='<a class=links href="',i='" title="',s='">',o="</a>",u,a=CloudFunc.NOJS,f=CloudFunc.FS;u=r+f+a+i+'"/"'+s+"/"+o;for(n=t.length-1;n>0;n--){var l=t[n],c=l.replace(l.substr(l,l.lastIndexOf("/")+1),"");n!==1?u+=r+f+a+l+i+l+s+c+o+"/":u+=c+"/"}return u},CloudFunc.checkExtension=function(e,t){if(typeof t=="string"&&e.length>t.length){var n=e.length,r=e.lastIndexOf(t),i=n-r;return i===t.length}if(typeof t!="object"||!t.length)return!1;for(var s=0;s<e.length;s++)if(this.checkExtension(e,t[s]))return!0},CloudFunc._getFileTableHeader=function(e){var t="<li class=fm_header>";t+="<span class=mini-icon></span>";for(var n=0;n<e.length;n++){var r=e[n];t+="<span class="+r+">"+r+"</span>"}return t+="</li>",t},CloudFunc.buildFromJSON=function(e,t){var n;n=e;var r=n[0].path;CloudFunc.Path=r;var i=CloudFunc._getDirPath(r),s=CloudFunc.removeLastSlash(r),o=CloudFunc.NOJS,u=CloudFunc.FS,a='<li class=path><span class="path-icon clear-cache"id=clear-cache title="clear cache (Ctrl+D)"></span><span class="path-icon '+CloudFunc.REFRESHICON+'"'+' title="refresh (Ctrl+R)">'+'<a href="'+u+o+s+'">'+"</a>"+"</span>"+"<span>"+i+"</span>"+"</li>",f=["name","size","owner","mode"];a+=CloudFunc._getFileTableHeader(f);if(r!=="/"){var l;l=r.substr(r,r.lastIndexOf("/")),l=l.substr(l,l.lastIndexOf("/")),l===""&&(l="/"),a+='<li draggable class=current-file><span class="mini-icon directory"></span><span class=name><a href="'+u+o+l+'" draggable=true>'+"..</a>"+"</span>"+"<span class=size>&lt;dir&gt;</span>"+"<span class=owner>.</span>"+"<span class=mode></span>"+"</li>"}var c=n.length;for(var h=1;h<c;h++)a+="<li draggable class>",a+='<span draggable class="mini-icon ',a+=(n[h].size==="dir"?"directory":"text-file")+'">',a+="</span>",a+='<span draggable class=name><a href="'+u+o+r+n[h].name+'"'+(n[h].size==="dir"?"":' target="_blank"')+(n[h].name.length>CloudFunc.SHORTNAMELENGTH?' title="'+n[h].name+'">'+CloudFunc.getShortedName(n[h].name):"draggable=true>"+n[h].name)+"</a>"+"</span>",a+="<span draggable class=size>"+(n[h].size==="dir"?"&lt;dir&gt;":CloudFunc.getShortedSize(n[h].size)),a+="</span><span draggable class=owner>"+(n[h].uid?n[h].uid:"root")+"</span>"+"<span draggable class=mode>"+CloudFunc.convertPermissionsToSymbolic(n[h].mode)+"</span>",a+="</li>";return t&&r==="/"&&a.indexOf("<li class=current-file>")<0&&(a=a.replace("<li draggable class>","<li draggable class=current-file>")),a};var exports;exports&&(exports.checkExtension=CloudFunc.checkExtension,exports.buildFromJSON=CloudFunc.buildFromJSON,exports.setTitle=CloudFunc.setTitle,exports.getUserUIDsAndNames=CloudFunc.getUserUIDsAndNames,exports.Name=CloudFunc.NAME,exports.NOJS=CloudFunc.NOJS,exports.FS=CloudFunc.FS)